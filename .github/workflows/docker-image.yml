name: Docker Image CI

on:
  push:
    tags:
    - '*'
  # To have GitHub Actions deploy a new version, create a new tag
  # git tag -a yyyy.m.d -m yyyy.m.d
  # Then push those tags
  # git push --tags
  # Then a new version will be deployed on the self-hosted runner.

jobs:

  build:

    runs-on: self-hosted

    steps:
    - uses: actions/checkout@v3
    - name: Docker compose down
      run: docker-compose down
    - name: Docker compose up
      run: COMPOSE_DOCKER_CLI_BUILD=1 \
           DOCKER_BUILDKIT=1 \
           docker-compose up -d --build
