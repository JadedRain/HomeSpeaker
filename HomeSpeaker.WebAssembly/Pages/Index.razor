@page "/"
@inject HomeSpeakerService svc;
@using Microsoft.Fast.Components.FluentUI


<div class="input-group">
    <input type="text" class="form-control" placeholder="Search / Filter" @bind=@filterValue />
    <span class="oi oi-magnifying-glass input-group-text"></span>
</div>

@if (songs == null)
{
    <p>Loading...</p>
}
else
{
    <FluentTreeView>
        @foreach (var artist in from s in songs
                               group s by s.Artist into artists
                               orderby artists.Key
                               select artists)
        {
            <FluentTreeItem>
                @artist.Key
                @foreach (var album in from song in artist
                                      group song by song.Album into album
                                      select album)
                {
                    <FluentTreeItem>
                        @album.Key
                        @foreach (var song in album)
                        {
                            <FluentTreeItem>@song.Name</FluentTreeItem>
                        }
                    </FluentTreeItem>
                }
            </FluentTreeItem>
        }
    </FluentTreeView>
}

@code {
    private string filterValue;
    public string FilterValue
    {
        get => filterValue;
        set
        {
            filterValue = value;
        }
    }

    IEnumerable<SongViewModel>? songs;

    protected override async Task OnInitializedAsync()
    {
        songs = await svc.GetAllSongsAsync();
    }

}