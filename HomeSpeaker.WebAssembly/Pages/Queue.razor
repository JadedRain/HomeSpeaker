@page "/Queue"
@inject HomeSpeakerService svc

<button @onclick=refresh class="btn btn-secondary position-absolute top-10 end-0 mx-3"><span class="oi oi-reload"></span></button>

<div class="row">
    <div class="col-auto">
        <h3>Now Playing:</h3>
    </div>
    <div class="col-12 col-lg h3">
        @currentSong
    </div>
</div>


<h4 class="mt-3">Playback Controls</h4>
<PlayControls />

<h4 class="mt-3 mb-0">Queue</h4> <div class="fs-6 mt-0">(@queue?.Count().ToString("n0") songs in queue)</div>

@if (queue == null)
{
    <div>Loading queue...</div>
}
else
{

    @foreach (var song in queue)
    {
        <QueueItem SongViewModel=song />
    }
}

@code {
    IEnumerable<SongViewModel> queue;
    string currentSong;

    protected override async Task OnInitializedAsync()
    {
        await refresh();
        svc.QueueChanged += async (_, _) => await refresh();
    }

    async Task refresh()
    {
        queue = await svc.GetPlayQueueAsync();
        var status = await svc.GetStatusAsync();
        currentSong = status?.CurrentSong?.Name ?? "[ Not playing anything ]";
        StateHasChanged();
    }
}
